{
  "info": {
    "name": "Shipcrowd Security",
    "description": "Comprehensive collection for testing all Shipcrowd security features including account lockout, session management, CSRF protection, rate limiting, and security headers.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "item": [
    {
      "name": "1. Account Lockout",
      "item": [
        {
          "name": "Login (Attempt 1)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "// Increment login attempts counter",
                  "var attempts = parseInt(pm.environment.get('loginAttempts') || '0');",
                  "pm.environment.set('loginAttempts', (attempts + 1).toString());"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"WrongPassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            },
            "description": "Attempt to login with incorrect password (1st attempt)"
          },
          "response": []
        },
        {
          "name": "Login (Attempt 5 - Should Lock)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "// Increment login attempts counter",
                  "var attempts = parseInt(pm.environment.get('loginAttempts') || '0');",
                  "pm.environment.set('loginAttempts', (attempts + 1).toString());",
                  "",
                  "// Check if account is locked",
                  "if (jsonData && jsonData.locked) {",
                  "    pm.environment.set('accountLocked', 'true');",
                  "    if (jsonData.lockExpires) {",
                  "        pm.environment.set('lockExpires', jsonData.lockExpires);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"WrongPassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            },
            "description": "Attempt to login with incorrect password (5th attempt, should lock account)"
          },
          "response": []
        },
        {
          "name": "Login (After Lock)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"{{userPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            },
            "description": "Attempt to login with correct password after account is locked"
          },
          "response": []
        }
      ],
      "description": "Tests for account lockout after multiple failed login attempts"
    },
    {
      "name": "2. Session Management",
      "item": [
        {
          "name": "Get Active Sessions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sessions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sessions"
              ]
            },
            "description": "Get all active sessions for the current user"
          },
          "response": []
        },
        {
          "name": "Revoke Specific Session",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"sessionId\": \"{{sessionId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sessions/{{sessionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sessions",
                "{{sessionId}}"
              ]
            },
            "description": "Revoke a specific session by ID"
          },
          "response": []
        },
        {
          "name": "Revoke All Other Sessions",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sessions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sessions"
              ]
            },
            "description": "Revoke all sessions except the current one"
          },
          "response": []
        }
      ],
      "description": "Tests for session management features"
    },
    {
      "name": "3. CSRF Protection",
      "item": [
        {
          "name": "Get CSRF Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData && jsonData.csrfToken) {",
                  "    pm.environment.set('csrfToken', jsonData.csrfToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/csrf-token",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "csrf-token"
              ]
            },
            "description": "Get a CSRF token for protected requests"
          },
          "response": []
        },
        {
          "name": "Protected Request with CSRF Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"data\": \"test data\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/protected-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "protected-resource"
              ]
            },
            "description": "Make a request to a protected endpoint with a valid CSRF token"
          },
          "response": []
        },
        {
          "name": "Protected Request without CSRF Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"data\": \"test data\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/protected-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "protected-resource"
              ]
            },
            "description": "Make a request to a protected endpoint without a CSRF token (should fail)"
          },
          "response": []
        }
      ],
      "description": "Tests for CSRF protection"
    },
    {
      "name": "4. Rate Limiting",
      "item": [
        {
          "name": "Rapid Requests (1)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "public-resource"
              ]
            },
            "description": "Make a request to a rate-limited endpoint (1st request)"
          },
          "response": []
        },
        {
          "name": "Rapid Requests (10)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "public-resource"
              ]
            },
            "description": "Make a request to a rate-limited endpoint (10th request)"
          },
          "response": []
        },
        {
          "name": "Rapid Requests (Exceeding Limit)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "public-resource"
              ]
            },
            "description": "Make a request to a rate-limited endpoint (exceeding limit, should be blocked)"
          },
          "response": []
        }
      ],
      "description": "Tests for API rate limiting"
    },
    {
      "name": "5. JWT Token Security",
      "item": [
        {
          "name": "Access Protected Resource with Valid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/profile",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "profile"
              ]
            },
            "description": "Access a protected resource with a valid JWT token"
          },
          "response": []
        },
        {
          "name": "Access Protected Resource with Expired Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{expiredToken}}",
                "description": "Expired JWT token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/profile",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "profile"
              ]
            },
            "description": "Attempt to access a protected resource with an expired JWT token (should fail)"
          },
          "response": []
        },
        {
          "name": "Access Protected Resource with Invalid Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid.token.format",
                "description": "Invalid JWT token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/profile",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "profile"
              ]
            },
            "description": "Attempt to access a protected resource with an invalid JWT token (should fail)"
          },
          "response": []
        }
      ],
      "description": "Tests for JWT token security"
    },
    {
      "name": "6. Security Headers",
      "item": [
        {
          "name": "Check Security Headers",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Check for security headers",
                  "pm.test(\"Content-Security-Policy header is present\", function () {",
                  "    pm.response.to.have.header(\"Content-Security-Policy\");",
                  "});",
                  "",
                  "pm.test(\"X-Content-Type-Options header is present\", function () {",
                  "    pm.response.to.have.header(\"X-Content-Type-Options\");",
                  "});",
                  "",
                  "pm.test(\"X-Frame-Options header is present\", function () {",
                  "    pm.response.to.have.header(\"X-Frame-Options\");",
                  "});",
                  "",
                  "pm.test(\"Strict-Transport-Security header is present\", function () {",
                  "    pm.response.to.have.header(\"Strict-Transport-Security\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public-resource",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "public-resource"
              ]
            },
            "description": "Check for security headers in API responses"
          },
          "response": []
        }
      ],
      "description": "Tests for security headers in API responses"
    },
    {
      "name": "7. Password Strength",
      "item": [
        {
          "name": "Register with Weak Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"password\",\n    \"name\": \"Test User\",\n    \"role\": \"seller\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            },
            "description": "Attempt to register with a weak password (should fail)"
          },
          "response": []
        },
        {
          "name": "Register with Medium Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123\",\n    \"name\": \"Test User\",\n    \"role\": \"seller\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            },
            "description": "Attempt to register with a medium-strength password"
          },
          "response": []
        },
        {
          "name": "Register with Strong Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"test@example.com\",\n    \"password\": \"Password123!@#\",\n    \"name\": \"Test User\",\n    \"role\": \"seller\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            },
            "description": "Attempt to register with a strong password (should succeed)"
          },
          "response": []
        }
      ],
      "description": "Tests for password strength requirements"
    },
    {
      "name": "8. Account Management",
      "item": [
        {
          "name": "Deactivate Account",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"password\": \"{{userPassword}}\",\n    \"reason\": \"Testing account deactivation\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/deactivate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "deactivate"
              ]
            },
            "description": "Deactivate the current user's account"
          },
          "response": []
        },
        {
          "name": "Reactivate Account",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{userEmail}}\",\n    \"password\": \"{{userPassword}}\",\n    \"token\": \"{{reactivationToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/reactivate",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "reactivate"
              ]
            },
            "description": "Reactivate a deactivated account"
          },
          "response": []
        },
        {
          "name": "Delete Account",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}",
                "description": "JWT access token"
              },
              {
                "key": "x-csrf-token",
                "value": "{{csrfToken}}",
                "description": "CSRF token for protection"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"password\": \"{{userPassword}}\",\n    \"confirmPhrase\": \"DELETE MY ACCOUNT\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            },
            "description": "Permanently delete the current user's account"
          },
          "response": []
        }
      ],
      "description": "Tests for account management features (deactivation, reactivation, deletion)"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Generate a CSRF token if not already set",
          "if (!pm.environment.get('csrfToken')) {",
          "    var uuid = require('uuid');",
          "    pm.environment.set('csrfToken', uuid.v4());",
          "}",
          "",
          "// Ensure user variables are set with valid test values",
          "if (!pm.environment.get('userEmail')) {",
          "    pm.environment.set('userEmail', 'business.cyperstudio@gmail.com');",
          "}",
          "if (!pm.environment.get('userPassword')) {",
          "    pm.environment.set('userPassword', 'Password123!');",
          "}",
          "",
          "// Set Origin header to mimic request from frontend",
          "const clientUrl = pm.environment.get('clientUrl') || 'http://localhost:3000';",
          "pm.request.headers.add({",
          "    key: 'Origin',",
          "    value: clientUrl",
          "});"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5005",
      "type": "string",
      "description": "Base URL for the Shipcrowd API server"
    }
  ]
}